@use "./base.scss";

:root {
  --tab-gradient-size: 80px; 
  --tab-header-height: 48px;
}

.tab-container.tab-overflow-wrapper {
  position: relative;
  display: flex;
  flex-direction: column;
  margin: 1.5rem 0;
  border: 1px solid var(--lightgray);
  border-radius: 6px;
  isolation: isolate; 
  overflow: hidden;

  /* 1. Header & Label Styling */
  .tab-overflow-content {
    width: 100%;
    overflow-x: auto;
    overflow-y: hidden;
    display: flex;
    background-color: var(--lightgray);
    scrollbar-width: none;
    &::-webkit-scrollbar { display: none; }
    z-index: 1;

    -webkit-mask-image: linear-gradient(to right, black, black);
    mask-image: linear-gradient(to right, black, black);

    label {
      padding: 0.75rem 1.25rem;
      white-space: nowrap;
      flex-shrink: 0;
      font-weight: 600;
      cursor: pointer;
      color: var(--darkgray);
      border-bottom: 2px solid transparent;
      margin-bottom: -1px;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      user-select: none;
      -webkit-user-select: none;

      &:hover { background-color: var(--gray); color: var(--dark); }
    }

    input[type="radio"] { display: none !important; }
    input[type="radio"]:checked + label {
      color: var(--secondary);
      border-bottom: 2px solid var(--secondary);
      background: var(--light);
    }
  }

  /* 2. Numbered Argument Logic */
  &[data-numbered="true"] {
    .tab-overflow-content {
      counter-reset: tab-counter;
      label {
        gap: 10px; 
        &::before {
          counter-increment: tab-counter;
          content: counter(tab-counter);
          display: flex;
          align-items: center;
          justify-content: center;
          width: 20px;
          height: 20px;
          border-radius: 50%;
          font-size: 0.85rem;
          font-weight: 800;
          line-height: 1 !important;
          padding-top: 1.5px !important;
          padding-left: 0.75px !important;
          background-color: var(--darkgray); 
          color: var(--lightgray); 
          transition: all 0.2s ease;
        }
      }
      input[type="radio"]:checked + label::before {
        background-color: var(--secondary);
        color: var(--light);
      }
    }
  }

  /* 3. Gradient Masking States */
  &[data-overflow-left="true"] .tab-overflow-content {
    -webkit-mask-image: linear-gradient(to right, transparent, black var(--tab-gradient-size));
  }
  &[data-overflow-right="true"] .tab-overflow-content {
    -webkit-mask-image: linear-gradient(to left, transparent, black var(--tab-gradient-size));
  }
  &[data-overflow-left="true"][data-overflow-right="true"] .tab-overflow-content {
    -webkit-mask-image: linear-gradient(to right, transparent, black var(--tab-gradient-size), black calc(100% - var(--tab-gradient-size)), transparent);
  }

  /* 4. Tab Panes */
  .tab-content-wrapper { padding: 0 !important; background-color: var(--light); z-index: 1; }
  .tab-pane {
    display: none; padding: 1.25rem; position: relative;
    &[data-animated="true"] { animation: tabFadeIn 0.2s ease; }
    .tab-toc-anchor { visibility: hidden; position: absolute; top: -100px; left: 0; height: 0; width: 0; pointer-events: none; }
    & > *:last-child { margin-bottom: 0 !important; }
    h4 { font-size: 1.5rem; font-weight: 700; margin-top: 1.5rem; margin-bottom: 0.75rem; color: var(--dark); }
    h5 { font-size: 1.25rem; font-weight: 600; margin-top: 1.25rem; color: var(--darkgray); }
    .tab-fake-header strong { display: block; font-size: 1.5rem; margin-top: 1.5rem; margin-bottom: 0.75rem; line-height: 1.2; }
    &.image-only {
      padding: 0 !important; line-height: 0; animation: none !important;
      p { margin: 0 !important; padding: 0 !important; line-height: 0; }
      img { width: 100%; display: block; border: none !important; border-radius: 0 !important; margin: 0 !important; }
    }
    p, h1, h2, h3, blockquote, ul, ol { 
        margin: 0 0 1rem 0; 
    }

    .callout-title-inner * {
        margin: 0;
    }
  }

  /* 5. Navigation Arrows UI */
  .tab-overflow-nav {
    position: absolute;
    top: 0; left: 0; right: 0;
    height: var(--tab-header-height);
    pointer-events: none;
    display: flex;
    justify-content: space-between;
    z-index: 3;
    .tab-nav-button {
        pointer-events: auto !important; 
        cursor: pointer !important;

      width: 35px; height: 100%; border: none; background: transparent;
      display: flex; align-items: center; justify-content: center;
      opacity: 0; visibility: hidden; transition: 0.2s;
      &::before { content: ""; width: 8px; height: 8px; border-right: 2px solid var(--darkgray); border-bottom: 2px solid var(--darkgray); }
    }
    .tab-nav-button-left { &::before { transform: rotate(135deg); margin-left: 8px; } }
    .tab-nav-button-right { &::before { transform: rotate(-45deg); margin-right: 8px; } }
  }
  &[data-overflow-left="true"] .tab-nav-button-left { opacity: 1; visibility: visible; pointer-events: auto; }
  &[data-overflow-right="true"] .tab-nav-button-right { opacity: 1; visibility: visible; pointer-events: auto; }

  /* 6. Alignment Overrides */
  &[data-alignment="bottom"] {
    .tab-overflow-content { border-top: 1px solid var(--lightgray); border-bottom: none; }
    .tab-overflow-nav { top: auto; bottom: 0; }
    label { border-bottom: none; border-top: 2px solid transparent; margin-top: -1px; }
    input[type="radio"]:checked + label { border-top: 2px solid var(--secondary); border-bottom: none; }
  }
  &[data-alignment="top"] .tab-overflow-content { border-bottom: 1px solid var(--lightgray); }
}

/* 6. Switcher & Animations */
@for $i from 1 through 100 {
  @for $j from 0 through 20 {
    .tab-container:has(input#tab-#{$i}-#{$j}:checked) .tab-pane[data-for="tab-#{$i}-#{$j}"] { display: block !important; }
  }
}

@keyframes tabFadeIn {
  from { opacity: 0; transform: translateY(3px); }
  to { opacity: 1; transform: translateY(0); }
}

/* 7. TOC Styling */
.toc-content { counter-reset: toc-tab-counter; }
.toc-content li.depth-2 {
  a[data-for] {
    display: inline-flex !important;
    align-items: center !important;
    text-decoration: none;
    padding: 0 !important;
    vertical-align: middle !important; 

    &::before {
      counter-increment: toc-tab-counter;
      content: counter(toc-tab-counter);
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      flex-shrink: 0;
      width: 18px !important;
      height: 18px !important;
      aspect-ratio: 1 / 1 !important; 
      margin-right: 8px !important;
      border-radius: 50% !important;
      font-size: 0.75rem !important;
      font-weight: 800 !important;
      line-height: 1 !important;
      text-align: center !important;
      position: relative !important;
      padding-top: 1.5px !important;  
      padding-left: 0.5px !important; 
      background-color: var(--darkgray);
      color: var(--lightgray);
    }

    &.in-view {
      color: var(--dark) !important; 
      &::before {
        background-color: var(--dark) !important; 
        color: var(--light) !important; 
        box-shadow: 0 0 4px var(--light);
      }
    }
  }
}

article *, .tab-pane * {
  // Disables automatic hyphenation
  hyphens: none !important;
  -webkit-hyphens: none !important;
  -moz-hyphens: none !important;
  -ms-hyphens: none !important;

  // Prevents breaking words in the middle
  word-break: normal !important;
  
  // Only wrap long strings (like URLs) if they absolutely must break
  overflow-wrap: break-word !important;
}

// This is supposed to fix the margin for code blocks
.tab-pane ol li pre {
    margin-bottom: 16px;
}

// Fix the bottom margin for elements in a list in the tab pane
.tab-pane ol li p {
  img {
    // Default: bottom margin if there are more elements after the paragraph
    margin-bottom: 6px;

    // If this paragraph (containing the image) is the last element 
    // inside the list item, remove the margin.
    &:last-child,
    &:only-child {
      margin-bottom: 0px;
    }
  }
}

.callout[data-callout="eyed"],
.callout[data-callout="discord"],
.callout[data-callout="twitch"] {
    --color: var(--secondary);
    --border: var(--lightgray);
    // --color: #7289da;      /* Discord Blue */
    // --border: #7289da;     /* Main accent color */
    // --bg: rgba(114, 137, 218, 0.1); /* Translucent blue background */
    --callout-icon: url('data:image/svg+xml;charset=utf-8,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 -28.5 256 256"%3E%3Cpath d="M216.856 16.597C200.285 8.843 182.566 3.208 164.042 0c-2.275 4.113-4.933 9.645-6.766 14.046-19.692-2.961-39.203-2.961-58.533 0-1.832-4.401-4.55-9.933-6.846-14.046C73.353 3.208 55.613 8.864 39.042 16.638 5.618 67.147-3.443 116.401 1.087 164.956c22.169 16.555 43.654 26.612 64.775 33.193 5.215-7.177 9.866-14.807 13.873-22.848-7.631-2.9-14.94-6.478-21.846-10.632 1.832-1.357 3.624-2.776 5.356-4.236 42.123 19.702 87.89 19.702 129.51 0 1.752 1.46 3.544 2.879 5.356 4.236-6.927 4.175-14.256 7.753-21.887 10.653 4.007 8.021 8.638 15.671 13.873 22.848 21.142-6.58 42.646-16.637 64.815-33.193 5.316-56.288-9.08-105.09-38.056-148.359zM85.474 135.095c-12.645 0-23.015-11.805-23.015-26.18 0-14.375 10.149-26.2 23.015-26.2 12.867 0 23.236 11.825 23.015 26.2.02 14.375-10.149 26.18-23.015 26.18zm85.051 0c-12.645 0-23.015-11.805-23.015-26.18 0-14.375 10.148-26.2 13.015-26.2 12.866 0 23.236 11.825 23.015 26.2 0 14.375-10.149 26.18-23.015 26.18z" fill="currentColor"/%3E%3C/svg%3E');
}

.callout[data-callout="twitch"] {
    --callout-icon: url('data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%239146ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"%3E%3Cpath d="M21 2H3v16h5v4l4-4h5l4-4V2zm-10 9V7m5 4V7"/%3E%3C/svg%3E');
}

// blue question callout
// .callout[data-callout="question"] {
//     --color: #448aff;
//     --border: #448aff44;
//     --bg: #448aff10;
//     --callout-icon: var(--callout-icon-question);
// }

// grey question callout
.callout[data-callout="question"],
.callout[data-callout="quote"],
.callout[data-callout="transcript"] {
    --color: hsl(218, 0%, 63%);
    --border: hsla(218, 0%, 63%, 0.267);
    --bg: hsla(218, 0%, 63%, 0.063);
}

.callout[data-callout="transcript"] {
    --callout-icon: url('data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%235865f2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"%3E%3Crect width="18" height="14" x="3" y="5" rx="2" ry="2"/%3E%3Cpath d="M7 15h4M15 15h2M7 11h2M13 11h4"/%3E%3C/svg%3E');
}

.callout[data-callout="question"] {
    --callout-icon: var(--callout-icon-question);
}


.callout[data-callout="unsolved"] {
    --color: #db4242;
    --border: #db424244;
    --bg: #db424210;
    --callout-icon: var(--callout-icon-failure);
}

.callout[data-callout="deciphered"] {
    --color: #09ad7a;
    --border: #09ad7144;
    --bg: #09ad7110;
    --callout-icon: var(--callout-icon-success);
}

.callout-title>.callout-title-inner>p {
    font-size: 18px;
}

.callout {
    overflow: hidden;
}

.callout.is-collapsible > .callout-title {
    cursor: pointer;
}

/* 1. Set the default (no-content/collapsed) state to 16px */
.callout-title {
    padding-bottom: 16px;
    transition: padding-bottom 0.2s ease;

    user-select: none;
    -webkit-user-select: none; /* For Safari support */
}

/* 2. ONLY reduce padding to 8px if:
      - It is NOT collapsed AND
      - There is actually content following it */
.callout:not(.is-collapsed) > .callout-title:not(:last-child) {
    padding-bottom: 8px;
}

/* 3. Explicitly keep 16px when collapsed (redundant but safe) */
.is-collapsed > .callout-title {
    padding-bottom: 16px;
}

.twitch-embed {
  /* Layout */
  width: 100%;
  max-width: 850px; /* Limits size on large screens */
  aspect-ratio: 16 / 9; /* The magic line: maintains video shape */
  
  /* Styling */
  display: block;
  margin: 1rem 0;
  border: none;
  border-radius: 8px;
  
  /* Shadow to match callout depth */
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

